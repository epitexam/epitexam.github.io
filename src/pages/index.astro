---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import TechStack from "../components/TechStack.astro";
import GitHubProject from "../components/GitHubProject.astro";
import {
	SITE_DESCRIPTION,
	SITE_TITLE,
	GITHUB_URL,
	TECH_STACK,
} from "../consts";
import { Image } from "astro:assets";
import profile from "../assets/profile.webp";
import type { Project } from "../types/github";

let projects: Project[] = [];
if (import.meta.env.SSR) {
	try {
		const token = import.meta.env.TOKEN_GITHUB;
		const username = SITE_TITLE.toLowerCase().replace(/\s+/g, "");
		const response = await fetch(
			`https://api.github.com/users/${username}/repos?sort=pushed&per_page=6`,
			{
				headers: token ? { Authorization: `token ${token}` } : {},
				signal: AbortSignal.timeout(3000),
			},
		);
		if (response.ok) {
			const repos = (await response.json()) as Project[];
			projects = repos.slice(0, 6);
		}
	} catch (error) {
		console.warn("Failed to fetch GitHub projects:", error);
		projects = [];
	}
}
const lastUpdate = new Date().toLocaleDateString("fr-FR");
---

<!doctype html>
<html lang="fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>

	<body
		class="min-h-screen flex flex-col bg-[rgb(var(--bg))] overflow-x-hidden"
	>
		<Header />

		<main class="animate-fastIn">
			<section class="text-center space-y-8" id="hero">
				<div class="flex flex-col items-center gap-6">
					<Image
						src={profile}
						alt={`Avatar de ${SITE_TITLE}`}
						width={80}
						height={80}
						loading="eager"
						fetchpriority="high"
						class="rounded-full border border-accent-20 shadow-glow"
					/>

					<div class="space-y-2">
						<h1>
							Ici <span class="text-accent glow-text"
								>{SITE_TITLE}</span
							> üëã
						</h1>
						<p class="max-w-2xl mx-auto opacity-80">
							D√©veloppeur passionn√© par l'embarqu√©, le web et les
							syst√®mes connect√©s. Sp√©cialis√© en Full-stack, IoT et
							bas niveau.
						</p>
					</div>

					<div class="flex items-center gap-2 text-xs" role="status">
						<div
							class="w-2 h-2 rounded-full bg-accent animate-pulse"
						>
						</div>
						<span
							class="text-accent font-medium tracking-wider uppercase"
							>Disponible pour de nouveaux projets</span
						>
					</div>
				</div>

				<div class="flex flex-wrap justify-center gap-4">
					<a href="/blog" class="btn-terminal">Consulter le blog</a>
					<a
						href={GITHUB_URL}
						target="_blank"
						rel="noopener noreferrer"
						class="btn-terminal accent">GitHub</a
					>
				</div>
			</section>

			<section id="tech-stack" class="py-12 section-optimized">
				<h2 class="text-center mb-8">Stack Technique</h2>
				<div class="marquee-container">
					<div class="marquee-content">
						<div class="marquee-track">
							{
								TECH_STACK.map((tech) => (
									<TechStack tech={tech} />
								))
							}
						</div>
						<div class="marquee-track" aria-hidden="true">
							{
								TECH_STACK.map((tech) => (
									<TechStack tech={tech} />
								))
							}
						</div>
					</div>
				</div>
			</section>

			<section id="projects" class="space-y-8 section-optimized">
				<h2>Projets r√©cents</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					{
						projects.length > 0 ? (
							projects.map((repo: Project) => (
								<GitHubProject project={repo} />
							))
						) : (
							<div class="col-span-full text-center py-12 border border-dashed border-accent-20 rounded-lg opacity-60">
								<p>Aucun projet trouv√©.</p>
							</div>
						)
					}
				</div>
			</section>

			<footer
				class="mt-16 py-8 border-t border-accent-10 text-center opacity-40"
			>
				<p class="text-xs">Syst√®me mis √† jour le {lastUpdate}</p>
			</footer>
		</main>

		<Footer />
	</body>
</html>

<style>
	main {
		padding-top: 80px;
		flex: 1;
	}

	.animate-fastIn {
		animation: fadeIn 0.3s ease-out forwards;
	}
	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(5px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.marquee-container {
		position: relative;
		width: 100vw;
		left: 50%;
		right: 50%;
		margin-left: -50vw;
		margin-right: -50vw;
		overflow: hidden;
		mask-image: linear-gradient(
			to right,
			transparent,
			black 15%,
			black 85%,
			transparent
		);
		-webkit-mask-image: linear-gradient(
			to right,
			transparent,
			black 15%,
			black 85%,
			transparent
		);
	}
	.marquee-content {
		display: flex;
		width: max-content;
		animation: scroll 100s linear infinite;
		will-change: transform;
	}
	.marquee-track {
		display: flex;
		gap: 3rem;
		padding-right: 3rem;
	}
	@keyframes scroll {
		from {
			transform: translateX(0);
		}
		to {
			transform: translateX(-50%);
		}
	}

	.btn-terminal {
		display: inline-block;
		padding: 0.75rem 1.5rem;
		border: 1px solid rgba(var(--accent), 0.3);
		font-family: var(--font-title);
		font-size: 0.85rem;
		border-radius: var(--radius-sm);
		transition: all 0.2s ease;
	}
	.btn-terminal:hover {
		background: rgba(var(--accent), 0.05);
		box-shadow: var(--glow);
		border-color: rgb(var(--accent));
	}
	.btn-terminal.accent {
		background: rgba(var(--accent), 0.1);
		border-color: rgb(var(--accent));
	}
	.shadow-glow {
		box-shadow: 0 0 20px rgba(var(--accent), 0.15);
	}

	@media (max-width: 768px) {
		.marquee-container {
			mask-image: none;
			-webkit-mask-image: none;
		}
		main {
			padding-top: 70px;
		}
	}
</style>
