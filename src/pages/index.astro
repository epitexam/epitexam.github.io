---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import TechStack from "../components/TechStack.astro";
import GitHubProject from "../components/GitHubProject.astro";
import {
	SITE_DESCRIPTION,
	SITE_TITLE,
	GITHUB_URL,
	TECH_STACK,
} from "../consts";
import { Image } from "astro:assets";
import profile from "../assets/profile.webp";
import type { Project } from "../types/github";

let projects: Project[] = [];
if (import.meta.env.SSR) {
	try {
		const token = import.meta.env.TOKEN_GITHUB;
		const username = SITE_TITLE.toLowerCase().replace(/\s+/g, "");
		const response = await fetch(
			`https://api.github.com/users/${username}/repos?sort=pushed&per_page=6`,
			{
				headers: token ? { Authorization: `token ${token}` } : {},
				signal: AbortSignal.timeout(5000),
			},
		);
		if (response.ok) {
			const repos = (await response.json()) as Project[];
			projects = repos.slice(0, 6);
		}
	} catch (error) {
		projects = [];
	}
}
const lastUpdate = new Date().toLocaleDateString("fr-FR");
---

<!doctype html>
<html lang="fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>

	<body
		class="min-h-screen flex flex-col bg-[rgb(var(--bg))] overflow-x-hidden"
	>
		<Header />

		<main class="animate-fastIn container-limited">
			<section class="text-center space-y-8 pt-12" id="hero">
				<div class="flex flex-col items-center gap-6">
					<Image
						src={profile}
						alt={`Avatar`}
						width={80}
						height={80}
						loading="eager"
						fetchpriority="high"
						class="rounded-full border border-accent-20 shadow-glow"
					/>

					<div class="space-y-3">
						<h1 class="leading-tight">
							Ici <span class="text-accent glow-text"
								>{SITE_TITLE}</span
							> üëã
						</h1>
						<p class="max-w-2xl mx-auto opacity-80 leading-relaxed">
							D√©veloppeur passionn√© par l'embarqu√©, le web et les
							syst√®mes connect√©s. Sp√©cialis√© en Full-stack, IoT et
							bas niveau.
						</p>
					</div>

					<div
						class="flex items-center gap-2 text-[14px]"
						role="status"
					>
						<div
							class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"
						>
						</div>
						<span
							class="text-accent font-mono tracking-widest uppercase"
						>
							Disponible pour de nouveaux projets
						</span>
					</div>
				</div>

				<div class="flex flex-wrap justify-center gap-4">
					<a href="/blog" class="btn-terminal">./blog</a>
					<a
						href={GITHUB_URL}
						target="_blank"
						rel="noopener noreferrer"
						class="btn-terminal accent">./github</a
					>
				</div>
			</section>

			<section id="tech-stack" class="py-16">
				<h2
					class="text-center mb-10 text-xs opacity-50 uppercase tracking-[0.3em]"
				>
					Stack Technique
				</h2>
				<div class="marquee-wrapper">
					<div class="marquee-content">
						<div class="marquee-track">
							{
								TECH_STACK.map((tech) => (
									<TechStack tech={tech} />
								))
							}
						</div>
						<div class="marquee-track" aria-hidden="true">
							{
								TECH_STACK.map((tech) => (
									<TechStack tech={tech} />
								))
							}
						</div>
					</div>
				</div>
			</section>

			<section id="projects" class="space-y-8 pb-12">
				<h2 class="text-xl">Projets r√©cents</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					{
						projects.length > 0 ? (
							projects.map((repo: Project) => (
								<GitHubProject project={repo} />
							))
						) : (
							<div class="col-span-full text-center py-12 border border-dashed border-accent-10 rounded-lg opacity-40">
								<p class="text-sm">
									En attente de donn√©es GitHub...
								</p>
							</div>
						)
					}
				</div>
			</section>

			<footer
				class="mt-auto py-8 border-t border-accent-10 text-center opacity-30"
			>
				<p class="text-[10px] font-mono">MAJ: {lastUpdate}</p>
			</footer>
		</main>

		<Footer />
	</body>
</html>

<style>
	.container-limited {
		max-width: 960px;
		margin: 0 auto;
		padding: 80px 1.5rem 0 1.5rem;
		flex: 1;
	}

	.animate-fastIn {
		animation: fadeIn 0.4s ease-out forwards;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.marquee-wrapper {
		position: relative;
		width: 100%;
		overflow: hidden;
		-webkit-mask-image: linear-gradient(
			to right,
			transparent,
			black 15%,
			black 85%,
			transparent
		);
		mask-image: linear-gradient(
			to right,
			transparent,
			black 15%,
			black 85%,
			transparent
		);
	}

	.marquee-content {
		display: flex;
		width: max-content;
		flex-wrap: nowrap;
		animation: scroll 195s linear infinite;
		will-change: transform;
		transform: translateZ(0);
	}

	.marquee-track {
		display: flex;
		flex-shrink: 0;
		gap: 3rem;
		padding-right: 3rem;
	}

	.marquee-track > * {
		flex-shrink: 0;
	}

	@keyframes scroll {
		from {
			transform: translateX(0);
		}
		to {
			transform: translateX(-50%);
		}
	}

	.marquee-wrapper:hover .marquee-content {
		animation-play-state: paused;
	}

	.btn-terminal {
		display: inline-block;
		padding: 0.6rem 1.2rem;
		border: 1px solid rgba(var(--accent), 0.2);
		font-family: var(--font-mono, monospace);
		font-size: 1.1rem;
		border-radius: 4px;
		transition: all 0.2s ease;
		text-decoration: none !important;
	}

	.btn-terminal:hover {
		background: rgba(var(--accent), 0.05);
		border-color: rgb(var(--accent));
		box-shadow: 0 0 15px rgba(var(--accent), 0.1);
	}

	.btn-terminal.accent {
		background: rgba(var(--accent), 0.1);
		border-color: rgba(var(--accent), 0.4);
	}

	.shadow-glow {
		box-shadow: 0 0 20px rgba(var(--accent), 0.15);
	}

	@media (max-width: 768px) {
		.container-limited {
			padding-top: 70px;
		}
		.marquee-wrapper {
			mask-image: none;
			-webkit-mask-image: none;
		}
	}
</style>
