---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import TechStack from "../components/TechStack.astro";
import GitHubProject from "../components/GitHubProject.astro";
import { SITE_DESCRIPTION, SITE_TITLE, GITHUB_URL } from "../consts";

const stack = [
	// Frontend
	"ElectronJS",
	"Tauri",
	"React",
	"Next.js",
	"Preact",
	"Astro",
	"TailwindCSS",
	"Typescript",
	"Javascript",
	"Redux",
	"Jest",
	"Cypress",
	"Lua",

	// Backend
	"Node.js",
	"Nest",
	"Fastify",
	"Elysia",
	"Express.js",
	"Bun",
	"Python",
	"C",
	"C++",

	// Base de donnÃ©es
	"Postgres",
	"MongoDB",
	"MariaDB",
	"Prisma",
	"Redis",

	// DevOps / OS
	"Docker",
	"Podman",
	"Linux",
	"Windows ðŸ—¿â€‹",

	// Hardware / IoT
	"Asm 6502 / x64",
	"Arduino",
	"Raspberry",
	"ESP32",
];

let projects: any[] = [];
try {
	const token = import.meta.env.TOKEN_GITHUB || "";
	const username = SITE_TITLE.toLowerCase().replace(/\s+/g, "");
	const res = await fetch(`https://api.github.com/users/${username}/repos`, {
		headers: token ? { Authorization: `token ${token}` } : {},
	});

	if (res.ok) {
		const allProjects = await res.json();
		projects = allProjects
			.filter((repo: any) => !repo.fork)
			.sort(
				(a: any, b: any) =>
					new Date(b.pushed_at).getTime() -
					new Date(a.pushed_at).getTime(),
			)
			.slice(0, 4);
	} else {
		console.warn("GitHub API error:", res.status);
	}
} catch (err) {
	console.error("GitHub fetch failed:", err);
}
---

<html lang="fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body
		class="flex flex-col min-h-screen bg-[rgb(var(--bg))] text-[rgb(var(--text))] font-mono"
	>
		<Header />

		<main
			class="flex-grow px-6 md:px-8 lg:px-16 py-16 max-w-5xl mx-auto animate-fadeIn space-y-20"
		>
			<section class="text-center space-y-6">
				<div class="flex flex-col items-center gap-4">
					<img
						src="/profile.png"
						alt="Avatar"
						class="w-16 h-16 rounded-full border border-accent/30"
					/>

					<h1 class="text-4xl md:text-5xl font-bold tracking-tight">
						Ici <span class="text-accent">{SITE_TITLE} !</span> ðŸ‘‹
					</h1>
					<p
						class="text-lg opacity-80 max-w-2xl mx-auto leading-relaxed"
					>
						DÃ©veloppeur passionnÃ© par lâ€™embarquÃ©, le web et les
						systÃ¨mes connectÃ©s.
					</p>
					<p class="text-sm opacity-70">
						Full-stack / IoT / Bas niveau â€¢ ðŸ‡«ðŸ‡·
					</p>

					<div class="flex items-center gap-2 text-xs">
						<div
							class="w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"
						>
						</div>
						<span class="text-green-400"
							>Disponible pour de nouveaux projets</span
						>
					</div>
				</div>

				<div class="flex flex-wrap justify-center gap-4 mt-6">
					<!-- <a
						href="mailto:contact@example.com"
						class="group relative px-6 py-2.5 rounded-xl border border-accent/30 bg-[rgba(25,35,30,0.35)] text-accent transition-all duration-300 backdrop-blur-sm hover:border-accent/50 hover:shadow-[var(--glow)] no-underline"
						style="background: radial-gradient(ellipse at top left, rgba(25, 35, 30, 0.35), rgba(10, 15, 10, 0.15) 70%); box-shadow: 0 4px 12px rgba(0,0,0,0.2);"
					>
						Envoyer un email
					</a> -->

					<a
						href="/blog"
						class="group relative px-6 py-2.5 rounded-xl border border-text/20 bg-[rgba(25,35,30,0.35)] text-text transition-all duration-300 backdrop-blur-sm hover:border-text/40 hover:shadow-[var(--glow)] no-underline"
						style="background: radial-gradient(ellipse at top left, rgba(25, 35, 30, 0.35), rgba(10, 15, 10, 0.15) 70%); box-shadow: 0 4px 12px rgba(0,0,0,0.2);"
					>
						Voir le blog
					</a>

					<a
						href={GITHUB_URL}
						target="_blank"
						class="group relative px-6 py-2.5 rounded-xl border border-accent/30 bg-[rgba(25,35,30,0.35)] text-accent transition-all duration-300 backdrop-blur-sm hover:border-accent/50 hover:shadow-[var(--glow)] no-underline"
						style="background: radial-gradient(ellipse at top left, rgba(25, 35, 30, 0.35), rgba(10, 15, 10, 0.15) 70%); box-shadow: 0 4px 12px rgba(0,0,0,0.2);"
					>
						GitHub
					</a>
				</div>
			</section>

			<section
				class="text-center space-y-6 relative overflow-hidden py-8"
			>
				<h2 class="text-xl font-bold text-accent tracking-tight">
					Au quotidien :
				</h2>

				<div class="stack-marquee mt-15">
					<div class="marquee-row marquee-row-1 mb-5">
						{
							stack
								.concat(stack)
								.map((tech) => <TechStack tech={tech} />)
						}
					</div>
					<div class="marquee-row marquee-row-2">
						{
							stack
								.concat(stack)
								.map((tech) => <TechStack tech={tech} />)
						}
					</div>
					<div class="fade fade-left"></div>
					<div class="fade fade-right"></div>
				</div>
			</section>

			<section class="space-y-6">
				<h2 class="text-xl font-bold text-accent tracking-tight">
					Mes derniers projets :
				</h2>
				<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-15">
					{
						projects.length > 0 ? (
							projects.map((repo) => (
								<GitHubProject project={repo} />
							))
						) : (
							<p class="col-span-full text-center text-sm text-text/70">
								Aucun projet public trouvÃ© sur GitHub.
							</p>
						)
					}
				</div>
			</section>

			<p class="text-xs text-text/50 mt-8 text-center">
				DerniÃ¨re mise Ã  jour : {new Date().toLocaleDateString("fr-FR")}
			</p>
		</main>

		<Footer />
	</body>
</html>

<style>
	.stack-marquee {
		position: relative;
		overflow: hidden;
		mask-image: linear-gradient(
			to right,
			transparent 0%,
			black 10%,
			black 90%,
			transparent 100%
		);
		-webkit-mask-image: linear-gradient(
			to right,
			transparent 0%,
			black 10%,
			black 90%,
			transparent 100%
		);
	}

	.marquee-row {
		display: flex;
		gap: 1rem;
		white-space: nowrap;
		width: max-content;
		animation-timing-function: linear;
		will-change: transform;
		padding: 0.3rem 0;
	}

	.marquee-row-1 {
		animation: marquee-left 65s linear infinite;
	}

	.marquee-row-2 {
		animation: marquee-right 70s linear infinite;
		opacity: 0.8;
	}

	@keyframes marquee-left {
		0% {
			transform: translateX(0);
		}
		100% {
			transform: translateX(-50%);
		}
	}

	@keyframes marquee-right {
		0% {
			transform: translateX(-50%);
		}
		100% {
			transform: translateX(0);
		}
	}

	.fade {
		position: absolute;
		top: 0;
		bottom: 0;
		width: 8rem;
		pointer-events: none;
		z-index: 2;
	}

	.fade-left {
		left: 0;
		background: linear-gradient(
			to right,
			rgba(10, 12, 20, 1),
			rgba(10, 12, 20, 0)
		);
	}

	.fade-right {
		right: 0;
		background: linear-gradient(
			to left,
			rgba(10, 12, 20, 1),
			rgba(10, 12, 20, 0)
		);
	}

	@media (max-width: 720px) {
		.marquee-row-1 {
			animation-duration: 60s;
		}
		.marquee-row-2 {
			animation-duration: 65s;
		}
	}
</style>
