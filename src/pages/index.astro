---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import TechStack from "../components/TechStack.astro";
import GitHubProject from "../components/GitHubProject.astro";
import { SITE_DESCRIPTION, SITE_TITLE, GITHUB_URL } from "../consts";
import { Image } from "astro:assets";
import profile from "../assets/profile.webp";
import type { Project } from "../types/github";

const fullStack = [
	// Frontend
	"ElectronJS",
	"Tauri",
	"React",
	"Next.js",
	"Preact",
	"Astro",
	"TailwindCSS",
	"Typescript",
	"Javascript",
	"Redux",
	"Jest",
	"Cypress",
	"Lua",

	// Backend
	"Node.js",
	"Nest",
	"Fastify",
	"Elysia",
	"Express.js",
	"Bun",
	"Python",
	"C",
	"C++",
	"Godot",

	// Base de donnÃ©es
	"Postgres",
	"MongoDB",
	"MariaDB",
	"Prisma",
	"Redis",

	// DevOps / OS
	"Docker",
	"Podman",
	"Linux",
	"Windows ðŸ’€â€‹â€‹",
	"Debian",
	"Ubuntu",
	"Fedora",
	"Arch linux",

	// Hardware / IoT
	"Asm 6502 / x64",
	"Arduino",
	"Raspberry",
	"ESP32",
];

let projects: Project[] = [];
try {
	const token = import.meta.env.TOKEN_GITHUB || "";
	const username = SITE_TITLE.toLowerCase().replace(/\s+/g, "");
	const res = await fetch(`https://api.github.com/users/${username}/repos`, {
		headers: token ? { Authorization: `token ${token}` } : {},
	});
	if (res.ok) {
		projects = ((await res.json()) as Project[])
			.sort(
				(a: Project, b: Project) =>
					new Date(b.pushed_at).getTime() -
					new Date(a.pushed_at).getTime(),
			)
			.slice(0, 4);
	}
} catch {}

const stack = fullStack;
const mobileStack = fullStack.slice(0, Math.min(12, fullStack.length));
---

<html lang="fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body
		class="flex flex-col min-h-screen bg-[rgb(var(--bg))] text-[rgb(var(--text))] font-mono"
	>
		<Header />

		<main
			class="flex-grow px-6 md:px-8 lg:px-16 py-16 max-w-5xl mx-auto animate-fadeIn space-y-20"
		>
			<section class="text-center space-y-6">
				<div class="flex flex-col items-center gap-4">
					<Image
						src={profile}
						alt="Avatar"
						width={64}
						height={64}
						loading="eager"
						class="rounded-full border border-accent/30"
					/>
					<h1 class="text-4xl md:text-5xl font-bold tracking-tight">
						Ici <span class="text-accent">{SITE_TITLE} !</span> ðŸ‘‹
					</h1>
					<p
						class="text-lg opacity-80 max-w-2xl mx-auto leading-relaxed"
					>
						DÃ©veloppeur passionnÃ© par lâ€™embarquÃ©, le web et les
						systÃ¨mes connectÃ©s.
					</p>
					<p class="text-sm opacity-70">
						Full-stack / IoT / Bas niveau â€¢ ðŸ‡«ðŸ‡·
					</p>
					<div class="flex items-center gap-2 text-xs">
						<div
							class="w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"
						>
						</div>
						<span class="text-green-400"
							>Disponible pour de nouveaux projets</span
						>
					</div>
				</div>

				<div class="flex flex-wrap justify-center gap-4 mt-6">
					<a href="/blog" class="glass-button glass-neutral"
						>Voir le blog</a
					>
					<a
						href={GITHUB_URL}
						target="_blank"
						class="glass-button glass-accent">GitHub</a
					>
				</div>
			</section>

			<section
				class="text-center space-y-6 relative overflow-hidden py-8"
			>
				<h2 class="text-xl font-bold text-accent tracking-tight">
					Au quotidien :
				</h2>
				<div class="stack-marquee mt-15">
					<div class="marquee-row marquee-row-1 mb-5">
						{
							stack
								.concat(stack)
								.map((tech) => <TechStack tech={tech} />)
						}
					</div>
					<div class="marquee-row marquee-row-2">
						{
							stack
								.concat(stack)
								.map((tech) => <TechStack tech={tech} />)
						}
					</div>
					<div class="fade fade-left"></div>
					<div class="fade fade-right"></div>
				</div>
			</section>

			<section class="space-y-6">
				<h2 class="text-xl font-bold text-accent tracking-tight">
					Mes derniers projets :
				</h2>
				<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-15">
					{
						projects.length > 0 ? (
							projects.map((repo: Project) => (
								<GitHubProject project={repo} />
							))
						) : (
							<p class="col-span-full text-center text-sm text-text/70">
								Aucun projet public trouvÃ© sur GitHub.
							</p>
						)
					}
				</div>
			</section>

			<p class="text-xs text-text/50 mt-8 text-center">
				DerniÃ¨re mise Ã  jour : {new Date().toLocaleDateString("fr-FR")}
			</p>
		</main>

		<Footer />
	</body>
</html>

<style>
	.stack-marquee {
		position: relative;
		overflow: hidden;
		mask-image: linear-gradient(
			to right,
			transparent 0%,
			black 10%,
			black 90%,
			transparent 100%
		);
		-webkit-mask-image: linear-gradient(
			to right,
			transparent 0%,
			black 10%,
			black 90%,
			transparent 100%
		);
	}
	.marquee-row {
		display: flex;
		gap: 1rem;
		white-space: nowrap;
		width: max-content;
		animation-timing-function: linear;
		will-change: transform;
		padding: 0.3rem 0;
	}
	.marquee-row-1 {
		animation: marquee-left 65s linear infinite;
	}
	.marquee-row-2 {
		animation: marquee-right 70s linear infinite;
		opacity: 0.8;
	}
	@keyframes marquee-left {
		0% {
			transform: translateX(0);
		}
		100% {
			transform: translateX(-50%);
		}
	}
	@keyframes marquee-right {
		0% {
			transform: translateX(-50%);
		}
		100% {
			transform: translateX(0);
		}
	}
	.fade {
		position: absolute;
		top: 0;
		bottom: 0;
		width: 8rem;
		pointer-events: none;
		z-index: 2;
	}
	.fade-left {
		left: 0;
		background: linear-gradient(
			to right,
			rgba(10, 12, 20, 1),
			rgba(10, 12, 20, 0)
		);
	}
	.fade-right {
		right: 0;
		background: linear-gradient(
			to left,
			rgba(10, 12, 20, 1),
			rgba(10, 12, 20, 0)
		);
	}
	@media (max-width: 720px) {
		.marquee-row-1 {
			animation-duration: 60s;
		}
		.marquee-row-2 {
			animation-duration: 65s;
		}
	}
</style>
