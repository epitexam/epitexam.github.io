---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const EAGER_LIMIT = 3;
---

<!doctype html>
<html lang="fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>

	<body>
		<Header />

		<main>
			<section>
				<div class="blog-grid">
					{
						posts.map((post, index) => {
							const isEager = index < EAGER_LIMIT;
							const isHero = index === 0;

							return (
								<a
									href={`/blog/${post.id}/`}
									class:list={[
										"blog-card",
										{ featured: isHero },
									]}
								>
									{post.data.heroImage && (
										<div class="image-container">
											<Image
												src={post.data.heroImage}
												alt={post.data.title}
												width={isHero ? 960 : 480}
												height={isHero ? 480 : 240}
												loading={
													isEager ? "eager" : "lazy"
												}
												fetchpriority={
													isHero ? "high" : "auto"
												}
												decoding="async"
											/>
										</div>
									)}

									<h4 class="title">{post.data.title}</h4>

									<p class="date">
										<FormattedDate
											date={post.data.pubDate}
										/>
									</p>
								</a>
							);
						})
					}
				</div>
			</section>
		</main>

		<Footer />
	</body>
</html>

<style>
	body {
		display: flex;
		flex-direction: column;
		min-height: 100vh;
		padding-top: var(--header-height, 80px);
	}

	main {
		flex-grow: 1;
		width: 100%;
		max-width: 960px;
		margin: 0 auto;
		padding: 3rem 1.5rem;
		box-sizing: border-box;
	}

	.blog-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 4rem 2rem;
		width: 100%;
	}

	.blog-card {
		width: 100%;
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
		text-decoration: none;
		color: inherit;
	}

	.blog-card.featured {
		grid-column: 1 / -1;
		margin-bottom: 2rem;
	}

	.image-container {
		aspect-ratio: 2 / 1;
		width: 100%;
		overflow: hidden;
		border-radius: 12px;
		border: 1px solid rgba(255, 255, 255, 0.1);
		margin-bottom: 1.5rem;
		background: rgba(255, 255, 255, 0.02);
	}

	.image-container img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.title {
		margin: 0;
		color: rgb(var(--text));
		line-height: 1.2;
		font-weight: 600;
		font-size: 1.25rem;
		transition: color 0.3s ease;
	}

	.featured .title {
		font-size: clamp(1.8rem, 5vw, 2.5rem);
	}

	.date {
		margin-top: 0.75rem;
		color: rgba(var(--text), 0.6);
		font-size: 0.9rem;
	}

	.blog-card:hover .title {
		color: rgb(var(--accent));
	}

	.blog-card:hover img {
		transform: scale(1.03);
	}

	@media (max-width: 768px) {
		body {
			padding-top: var(--header-height, 70px);
		}

		.blog-grid {
			grid-template-columns: 1fr;
			gap: 3.5rem;
		}

		main {
			padding: 2rem 1rem;
		}

		.image-container {
			aspect-ratio: 16 / 9;
		}

		.featured .title {
			font-size: 1.6rem;
		}
	}
</style>
